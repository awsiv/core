CFENGINE 3 ENTERPRISE 3.0 Release Candidate 1
RELEASE DATE: November 2012
SCOPE: Installation and upgrade instructions for CFEngine 3 Enterprise 3.0 Release Candidate 1

-----------------------------------------------------------
 TABLE OF CONTENTS:
 REQUIREMENTS
 INSTALLATION INSTRUCTIONS (CLEAN INSTALL)
 UPGRADE PROCEDURE
 SOFTWARE DEPENDENCIES
-----------------------------------------------------------

For information about supported platforms, compatible hub/client configurations for this release and an overview of changes, please see the "3.0.0RC1-Release-Notes-CFEngine-3-Enterprise.txt" file that comes with this package.

This is a release candidate for testing, not intended for production environments!


REQUIREMENTS:
CFEngine recommends that your hub machine should have at least 2 GB of memory and a modern x86_64 processor. For a large number of clients we recommend, as a rule of thumb, to have 8 GB of memory available per 500 hosts bootstrapped to the hub (not applicable to CFEngine 3 Free Enterprise). Please contact your sales representative if you have any questions regarding these numbers. 

CFEngine recommends to have 256 MB available memory on the clients. For machines under CFEngine’s management (clients), a full installation of CFEngine 3 Enterprise requires about 25 MB of disk storage. Otherwise disk usage depends on your specific policies, especially those that concern reporting.

Verify that the machine’s network connection is working and that port 5308 (used by CFEngine) and port 80 (used for the Mission Portal) is open for both incoming and outgoing connections. A working package manager is required on the hub/policy server to install an Apache Web Server, php module, etc. You should start from a blank system (i.e. with none of these components installed) to avoid potential interference with the installation process. No special software is otherwise required on machines in your network, CFEngine bundles all critical dependencies in the CFEngine 3 Enterprise package (see also SOFTWARE DEPENDENCIES below).

Requirements specific to MongoDB:
1. Filesystem type:
- ext4 ( kernel version >= 2.6.23 )
- xfs ( kernel version >= 2.6.25 )
2. Memory: Approximately 8 GB per 500 hosts
3. Turn off NUMA if running on numa hardware. http://www.mongodb.org/display/DOCS/NUMA
4. Do not use large VM pages with Linux (info about large pages: http://linuxgazette.net/155/krishnakumar.html)
5. Set file descriptor limit and user process limit to 4k+ (see etc/limits and ulimit)

For those running databases on ext4 filesystems, a 2.6.23 kernel is required for efficient filesystem preallocation, 2.6.25 is required for XFS support of the same feature. High filesystem I/O following the allocation of new database files is one symptom of this problem.


INSTALLATION INSTRUCTIONS (CLEAN INSTALL):
* Clean install is tested, upgrade from previous versions of CFEngine 3 Nova not tested (use only Enterprise 3.0 Release Candidate packages for testing)
* As always, install HUB first, then client(s).
* For large systems (> 1000 hosts) we recommend increasing the memory limit in php.conf on the HUB (for instance to 128 MB)

CFEngine 3 Enterprise is provided in three packages (two hub and one client package), please make sure to install them on the corresponding machines (e.g. one machine intended to serve as hub (policy server) and other machines intended to serve as clients). These are the three packages (example for x86_64):
    cfengine-nova-3.0.0RC1-1-HUB.x86_64.rpm for the hub
    cfengine-nova-expansion-3.0.0RC1-1-HUB.x86_64.rpm for the hub
    cfengine-nova-3.0.0RC1-1.x86_64.rpm for the client 
The difference between the two cfengine-nova-3.0.0RC1-1 packages (for hub and client) is that the agent binaries for the hub are linked to the MongoDB library while the binary for clients are not. Installing a client package on the hub will result in a database connection error, the Mission Portal will not be available and reports will not be collected. Installing the hub package on clients will result in error reports stating that the agent failed to connect to MongoDB (because it is not existent in client packages; danger of filling up error logs), but otherwise functionality will be assured. Please take care to install the correct packages on the corresponding nodes. The expansion package is only installed on the policy hub. You should install and set up the hub first.

The general installation steps are as follows:
1. Copy the CFEngine 3 Enterprise packages to the system.
2. On the hub/policy server:
   a) Unpack the cfengine-nova and cfengine-nova-expansion packages (in that order):
      [RedHat/CentOS/SUSE]
        $ rpm -Uvh cfengine-nova-3.0.0RC1-1-HUB.x86_64.rpm
        $ rpm -Uvh cfengine-nova-expansion-3.0.0RC1-1-HUB.x86_64.rpm
   b)(Skip for CFEngine 3 Free Enterprise): Send the hub's public key (/var/cfengine/ppkeys/localhost.pub) to CFEngine support to obtain a license 
   c)(Skip for CFEngine 3 Free Enterprise): Copy the obtained license file to /var/cfengine/masterfiles/license.dat
3. On the clients: Unpack the cfengine-nova package:
   [RedHat/CentOS/SUSE]
     $ rpm -Uvh cfengine-nova-3.0.0RC1-1.x86_64.rpm
5. Bootstrap the machines to the hub (starting with bootstrapping the hub to itself): 
     $ /var/cfengine/bin/cf-agent --bootstrap --policy-server <IP ADDRESS OF HUB>
6. CFEngine should now be up and running on your system. The Mission Portal will not be immediately accessible, you should wait approximately 15 minutes for the system to converge before attempting to connect to the hub IP-address through your web browser. 

See Enterprise 3.0 Owner's Manual for more detailed installation instructions and troubleshooting tips.

If you wish to manually install cfmod to the machine, you'll need to do the following:
1. Make a symlink from php library directory (typically something like
     /usr/lib/php5/20100525) to $installdir/lib/php/cfmod.so
2. Put a configuration file (with .ini extension) to php configuration directory (typically something like /etc/php5/conf.d):
     extension=cfmod.so


UPGRADE PROCEDURE:
Upgrade is not supported for the CFEngine 3 Enterprise 3.0 Release Candidate, please use Enterprise 3.0 Release Candidate clients only.


SOFTWARE DEPENDENCIES (specific to CFEngine 3 Enterprise)
The CFEngine 3 Enterprise agents on client hosts do not require any additional packages for operation and/or install. The following section is for the hub only.

CFEngine 3 Enterprise will automatically detect if the necessary packages are already installed on the hub. If new package installation is required, CFEngine 3 Enterprise will install all of them from its default software repository (if configured properly). If the system does not have a default software repository configured, manual installation of these packages will be required.

Note that these mandatory packages may have additional dependencies on their own, and hence additional packages may be installed during the installation process. This process will be handled automatically by CFEngine bootstrap. We do not recommend configuring every component on your own, please contact your CFEngine sales representative in case you cannot use CFEngine's bootstrap procedure.

RHEL 5:
- Apache HTTP Server (httpd, version 2.2.3-45.el5)
- PHP5 Core Files (php, version 5.1.6-27.el5)
- PHP5 Extension Module
	(php-bcmath, version 5.1.6-27.el5)
	(php-pear, version 5.1.6-27.el5)

RHEL 6:
- Apache HTTP Server (httpd, version 2.2.15-9.el6)
- PHP5 Core Files (php, version 5.3.2-6.el6)
- PHP5 Extension Module
	(php-bcmath, version 5.3.2-6.el6)
	(php-pear, version 1:1.9.0-2.el6)

CentOS 5:
- Apache HTTP Server (httpd, version 2.2.3-45)
- PHP5 Core Files (php, version 5.1.6-27)
- PHP5 Extension Module
	(php-bcmath, version 5.1.6-27)
	(php-pear, version 5.1.6-27)
	(php-mcrypt, version 5.1.6-27)

DEBIAN 5:
- The Apache Web Server Version 2.0 (apache2, version 2.2.9-10+lenny9)
- PHP5 Core Files (php5, version 5.2.6.dfsg.1-1+lenny13)
- PHP5 Extension Module
	(php5-cli, version 5.2.6.dfsg.1-1+lenny13)
	(php5-mcrypt, version 5.2.6.dfsg.1-1+lenny13)
	(php-pear, version 5.2.6.dfsg.1-1+lenny13)

DEBIAN 6:
- The Apache Web Server Version 2.0 (apache2, version 2.2.16-6+squeeze1)
- PHP5 Core Files (php5, version 5.3.3-7+squeeze3)
- PHP5 Extension Module
	(php5-cli, version 5.3.3-7+squeeze3)
	(php5-mcrypt, version 5.3.3-7+squeeze3)
	(php-pear, version 5.3.3-7+squeeze3)

UBUNTU 8:
- The Apache Web Server Version 2.0 (apache2, version 2.2.8-1)
- PHP5 Core Files (php5, version 5.2.4-2ubuntu5.17)
- PHP5 Extension Module
	(php5-cli, version 5.2.4-2ubuntu5.17)
	(php5-mcrypt, version 5.2.3-0ubuntu1)
	(php-pear, version version 5.2.4-2ubuntu5.17)

UBUNTU 10:
- The Apache Web Server Version 2.0 (apache2, version 2.2.14-5ubuntu8.4)
- PHP5 Core Files (php5, version 5.3.2-1ubuntu4.9)
- PHP5 Extension Module
	(php5-cli, version 5.3.2-1ubuntu4.9)
	(php5-mcrypt, version 5.3.2-0ubuntu1)
	(php-pear, version version 5.3.2-1ubuntu4.9)

