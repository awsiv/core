CFENGINE 3 ENTERPRISE 3.0
CFEngine has renamed CFEngine 3 Nova to CFEngine 3 Enterprise
RELEASE DATE: June 4th, 2012
SCOPE: Installation and upgrade instructions for CFEngine 3 Enterprise (successor to CFENgine Nova 2.1.3)

PLATFORMS SUPPORTED:
Hub/Policy-server:
NAME		VERSION					ARCHITECTURE
Debian 		6 					i686,x86-64
Ubuntu 		8.04, 10.04, 12.04 			i686,x86-64
RHEL 		5, 6					i686,x86-64

Clients:
NAME:		VERSION					ARCHITECTURE		COMMENT
AIX		5.3, 6.1 				power			No libvirt
CentOS		5, 6 					i686,x86-64
Debian 		5, 6 					i686,x86-64
Fedora 		14, 15, 16 				i686,x86-64
FreeBSD 	7, 8 					i686,amd64		No libvirt
HP-UX										Contact your sales representative
NetBSD 		4.0, 5.0 				i686,amd64		No libvirt
NetBSD 		5.1 					i686,x86-64		No libvirt
openSUSE 	10.2, 10.3, 11.1, 11.2, 11.3, 11.4 	i686,x86-64
RHEL 		4, 5, 6 				i686,x86-64
SLES 		9, 10, 11 				i686,x86-64
SLES 		10, 11 					s390x
SUSE Linux 	9.1, 9.2, 9.3, 10.0, 10.1 		i686,x86-64
Solaris		8, 9, 10 				sparc	 		No libvirt
Solaris 	10 					i86pc	 		No libvirt
Ubuntu		8.04, 8.10, 9.04, 9.10,			i686,x86-64
Ubuntu		10.04, 10.10, 11.04, 11.10, 12.04 	i686,x86-64
Windows 	Server 2003, Server 2008		x86,x64			No libvirt, OpenSSL is not FIPS-enabled

Community version base: 3.4.0


BASIC INSTALLATION INSTRUCTIONS (CLEAN INSTALL):
* Clean install is tested, upgrade from previous versions of CFEngine 3 Nova tested (see following section)
* As always, install HUB first, then client(s).
* For large systems (> 1000 hosts) we recommend increasing the memory limit in php.conf on the HUB (for instance to 128 MB)

CFEngine 3 Enterprise is provided in two packages, cfengine-nova_2.2.0 and cfengine-nova-expansion_2.2.0 (the nova name remains in the packages to ensure backwards compatibility with package managers). The main software package must be installed on every host (including the hub). The expansion package is only installed on the policy hub. You should install and set up the hub first.

The general installation steps are as follows:
- Copy the CFEngine 3 Enterprise packages to the system.
- Unpack the software
- Send the hub's public key (/var/cfengine/ppkeys/localhost.pub) to CFEngine support to obtain a license (Skip for Free 25 deployment)
- Copy the obtained license file to /var/cfengine/masterfiles/license.dat (Skip for Free 25 deployment)
- Bootstrap the machines to the hub (staring with bootstrapping the hub to itself): /var/cfengine/bin/cf-agent --bootstrap --policy-server <IP ADDRESS OF HUB>
- CFEngine should now be up and running on your system. See Enterprise 2.2 Owner's Manual for more detailed installation instructions.


UPGRADE PROCEDURE:
The following is a general procedure to upgrade from CFEngine 3 Nova 2.1.x to CFEngine 3 Enterprise, see Enterprise 2.2 Owner's Manual for upgrading from older versions. 

Start with the hub (policy server):
* Stop all CFE processes (/etc/init.d/cfengine3 stop)
* Unpack the new software packages
* CFEngine 3 Enterprise's dependencies have changed so we have to correct cf-twin (libgnutls and libmongo.c were updated):
   $ cp /var/cfengine/bin/cf-agent /var/cfengine/bin/cf-twin
* Remove Mongodb lock if present:
   $ rm -f /var/cfengine/state/mongod.lock
* Copy the new CFE_ prefixed policy files to $(sys.workdir)/masterfiles (the files with a prefix "CFE_" are maintained by CFEngine, do not make changes to these, they are there to ensure that the Mission Portal works properly).
   $ cd /var/cfengine/share/NovaBase
   $ cp CFE_cfengine.cf CFE_knowledge.cf CFE_hub_specific.cf /var/cfengine/masterfiles
* Modify a line in @file{/var/cfengine/masterfiles/update.cf} to run mongod as follows (line 242):
   "/var/cfengine/bin/mongod --fork --logpath /var/log/mongod.log --dbpath $ (sys.workdir)/state --bind_ip 127.0.0.1 --nohttpinterface --nojournal --logappend > /dev/null < /dev/null 2>&1"
* Tidy up $(sys.doc_root) directory (example for Debian/Ubuntu):   
   $ rm -rf /var/www/*
* Restart CFEngine processes
   $ /etc/init.d/cfengine3 start

For client upgrades there are 2 approaches: manual or automatic upgrade.
* Manual: Update cfengine-nova on each client by rpm or dpkg command. Update cf-twin as described in step 3 in the update procedure for the hub (i.e. overwrite the old cf-twin).
* Automatic: On the hub, copy the cfengine-nova packages to the operating system specific distribution directories in /var/cfengine/master_software_updates and CFEngine 3 Enterprise will take care of the rest.

CFEngine should now be up and running on your system. See "Enterprise 2.2 Owner's Manual" for more detailed installation instructions and "Release Notes CFEngine 3 Enterprise.txt" for other important messages.



