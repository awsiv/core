abs_srcdir=@abs_srcdir@
abs_top_builddir=@abs_top_builddir@
MKDIR_P=@mkdir_p@

top_srcdir = $(abs_top_srcdir)
top_builddir = $(abs_top_builddir)
top_build_prefix = $(abs_top_build_builddir)/

.NOTPARALLEL: highlight_syntax check_km_substrings scan_texinfo scan_examples highlighted non-highlighted

all: clean highlight_syntax check_km_substrings scan_texinfo scan_examples highlighted non-highlighted

clean:
	rm -f scan_SpecialTopic_* rm NovaEvaluationGuide.html NovaEvaluationGuideSupplement.html SpecialTopic_* UpgradingCfengineNova.html highlight_syntax check_km_substrings scan_examples scan_texinfo cf_Quickref3.html scan_Nova* scan_UpgradingCfengineNova.cf scan_cf3ref.cf scan_glossary.cf scan_quickref3.cf *.trans

HIGHLIGHTED_OTHER = scan_cf3ref.cf scan_solutions.cf examples.cf scan_tutorial3.cf scan_bp3.cf scan_SpecialTopic_BDMA.cf scan_SpecialTopic_Monitoring.cf scan_SpecialTopic_Change.cf scan_SpecialTopic_OpenNebula.cf scan_SpecialTopic_Cloud.cf scan_SpecialTopic_Packages.cf scan_SpecialTopic_ContentDrivenPolicies.cf scan_SpecialTopic_RBAC.cf scan_SpecialTopic_DevOps.cf scan_SpecialTopic_Reporting.cf scan_SpecialTopic_DistributedScheduling.cf scan_SpecialTopic_Rollback.cf scan_SpecialTopic_Editing.cf scan_SpecialTopic_Scalability.cf scan_SpecialTopic_Federation.cf scan_SpecialTopic_Scan.cf scan_SpecialTopic_FIPS.cf scan_SpecialTopic_Schedule.cf scan_SpecialTopic_Hierarchy.cf scan_SpecialTopic_Security.cf scan_NovaEvaluationGuide.cf scan_SpecialTopic_Iteration.cf scan_SpecialTopic_Teamwork.cf scan_NovaEvaluationGuideSupplement.cf scan_SpecialTopic_ITIL.cf scan_SpecialTopic_Virtualization.cf scan_Enterprise-2-2-OwnersManual.cf scan_SpecialTopic_Knowledge.cf scan_SpecialTopic_Windows.cf scan_SpecialTopic_Adoption.cf scan_SpecialTopic_MenuDrivenConfig.cf scan_UpgradingCfengineNova.cf scan_SpecialTopic_Agility.cf scan_SpecialTopic_MissionCritical.cf scan_SpecialTopic_ApplMgt.cf scan_SpecialTopic_Modules.cf unit_peers.html
HIGHLIGHTED_HTML = cf3-solutions.html cf3-tutorial.html cf3-bestpractice.html cf3-conceptguide.html cf3-quickstart.html SpecialTopic_BDMA.html SpecialTopic_Monitoring.html SpecialTopic_Change.html SpecialTopic_OpenNebula.html SpecialTopic_Cloud.html SpecialTopic_Packages.html SpecialTopic_ContentDrivenPolicies.html SpecialTopic_RBAC.html SpecialTopic_DevOps.html SpecialTopic_Reporting.html SpecialTopic_DistributedScheduling.html  SpecialTopic_Rollback.html SpecialTopic_Editing.html SpecialTopic_Scalability.html SpecialTopic_Federation.html SpecialTopic_Scan.html SpecialTopic_FIPS.html SpecialTopic_Schedule.html SpecialTopic_Hierarchy.html SpecialTopic_Security.html SpecialTopic_Iteration.html SpecialTopic_Teamwork.html SpecialTopic_ITIL.html SpecialTopic_Virtualization.html SpecialTopic_Knowledge.html SpecialTopic_Windows.html SpecialTopic_Adoption.html SpecialTopic_MenuDrivenConfig.html SpecialTopic_Agility.html SpecialTopic_MissionCritical.html SpecialTopic_ApplMgt.html SpecialTopic_Modules.html

highlighted: $(HIGHLIGHTED_HTML) $(HIGHLIGHTED_OTHER)

NOVA_HIGHLIGHTED_HTML = NovaEvaluationGuide.html NovaEvaluationGuideSupplement.html UpgradingCfengineNova.html Enterprise-2-2-OwnersManual.html

nova_highlighted: $(NOVA_HIGHLIGHTED_HTML)


# Some manuals are not syntax highlighted because the formattingis not right.

non-highlighted: CfengineStdLibrary.html cf3-upgrade.html scan_upgrade.cf  cf_Quickref3.html scan_quickref3.cf scan_substrings.cf scan_glossary.cf
#
#
#

$(top_builddir)/docs/guides/%.html:
	(cd $(top_builddir)/docs/guides && $(MAKE) $*.html)

$(top_builddir)/nova/docs/%.html:
	(cd $(top_builddir)/docs/guides && $(MAKE) ../../nova/docs/$*.html)

$(top_builddir)/docs/reference/cf3-Reference.html:
	(cd $(top_builddir)/docs/reference && $(MAKE) cf3-Reference.html)


$(HIGHLIGHTED_HTML): %.html: $(top_builddir)/docs/guides/%.html
	cp $< .
	./highlight_syntax $@
	mv $*.trans $@

$(NOVA_HIGHLIGHTED_HTML): %.html: $(top_builddir)/nova/docs/%.html
	cp $< .
	./highlight_syntax $@
	mv $*.trans $@

scan_%.cf: %.html
	./scan_texinfo "special topic" $< > $@


scan_texinfo: scan_texinfo.c
	gcc -g -o scan_texinfo scan_texinfo.c

check_km_substrings: check_km_substrings.c
	gcc -g -o check_km_substrings check_km_substrings.c

highlight_syntax: highlight_syntax.c
	gcc -g -o highlight_syntax $<

scan_examples: scan_examples.c
	gcc -g -o scan_examples scan_examples.c

cf3-glossary.html: $(top_builddir)/docs/guides/cf3-glossary.html
	cp $< .

scan_substrings.cf: words check_km_substrings
	./check_km_substrings > scan_substrings.cf

scan_glossary.cf: cf3-glossary.html
	./scan_texinfo "special topic" $< > scan_glossary.cf




CfengineStdLibrary.html: stdlib.texinfo
	makeinfo  --html --no-split --css-include=cfcomdoc.css $<

scan_stdlib.cf: CfengineStdLibrary.html
	./scan_texinfo "community library" CfengineStdLibrary.html > scan_stdlib.cf

cf3-upgrade.html: $(top_builddir)/docs/guides/cf3-upgrade.html
	cp $< .

scan_upgrade.cf: cf3-upgrade.html
	./scan_texinfo "upgrading" cf3-upgrade.html > scan_upgrade.cf

scan_bp3.cf: cf3-bestpractice.html
	./scan_texinfo "cf3 best practice" cf3-bestpractice.html > scan_bp3.cf

scan_tutorial3.cf: cf3-tutorial.html
	./scan_texinfo "cf3 tutorial" cf3-tutorial.html > scan_tutorial3.cf

scan_solutions.cf: cf3-solutions.html
	./scan_texinfo "cf3 reference" cf3-solutions.html > scan_solutions.cf

cf3-Reference.html: $(top_builddir)/docs/reference/cf3-Reference.html
	cp $< .

scan_cf3ref.cf: cf3-Reference.html
	./scan_texinfo "cf3 reference" cf3-Reference.html > scan_cf3ref.cf

unit_peers.html: examples.cf

examples.cf: Units
	./scan_examples | grep warning

cf_Quickref3.html:  $(top_builddir)/docs/guides/cf_Quickref3.html
	cp $< .
scan_quickref3.cf:  cf_Quickref3.html
	./scan_texinfo "cf3 reference" cf_Quickref3.html > scan_quickref3.cf

install:

check:

#update:
#	scp -P222 *.html root@cf001lin.cfengine.com:/iu/eternity/cfsite/app/documents/cf-manuals/
#	scp -P222 ontology.html root@cf001lin.cfengine.com:/iu/eternity/cfsite/app/documents/cf-manuals/cf-ontology.html
#
#	(cd graphs; scp -P222 * root@cf001lin.cfengine.com:/iu/eternity/cfsite/app/webroot/copernicus/graphs)
#	scp -P222 *.png root@cf001lin.cfengine.com:/iu/eternity/cfsite/app/webroot/img/outside

