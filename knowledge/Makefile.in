abs_srcdir=@abs_srcdir@
abs_top_builddir=@abs_top_builddir@
MKDIR_P=@mkdir_p@

top_srcdir = $(abs_top_srcdir)
top_builddir = $(abs_top_builddir)
top_build_prefix = $(abs_top_build_builddir)/

.NOTPARALLEL: scan_examples highlight_syntax highlighted non-highlighted

all: clean scan_examples highlight_syntax highlighted non-highlighted

clean:
	rm -f NovaEvaluationGuide.html NovaEvaluationGuideSupplement.html SpecialTopic_* UpgradingCfengineNova.html highlight_syntax cf_Quickref3.html scan_examples

HIGHLIGHTED_OTHER = unit_peers.html
HIGHLIGHTED_HTML = cf3-solutions.html cf3-tutorial.html cf3-bestpractice.html cf3-conceptguide.html cf3-quickstart.html SpecialTopic_BDMA.html SpecialTopic_Monitoring.html SpecialTopic_Change.html SpecialTopic_OpenNebula.html SpecialTopic_Cloud.html SpecialTopic_Packages.html SpecialTopic_ContentDrivenPolicies.html SpecialTopic_RBAC.html SpecialTopic_DevOps.html SpecialTopic_Reporting.html SpecialTopic_DistributedScheduling.html  SpecialTopic_Rollback.html SpecialTopic_Editing.html SpecialTopic_Scalability.html SpecialTopic_Federation.html SpecialTopic_Scan.html SpecialTopic_FIPS.html SpecialTopic_Schedule.html SpecialTopic_Hierarchy.html SpecialTopic_Security.html SpecialTopic_Iteration.html SpecialTopic_Teamwork.html SpecialTopic_ITIL.html SpecialTopic_Virtualization.html SpecialTopic_Knowledge.html SpecialTopic_Windows.html SpecialTopic_Adoption.html SpecialTopic_MenuDrivenConfig.html SpecialTopic_Agility.html SpecialTopic_MissionCritical.html SpecialTopic_ApplMgt.html SpecialTopic_Modules.html

highlighted: $(HIGHLIGHTED_HTML) $(HIGHLIGHTED_OTHER)

NOVA_HIGHLIGHTED_HTML = NovaEvaluationGuide.html NovaEvaluationGuideSupplement.html UpgradingCfengineNova.html Enterprise-3-0-OwnersManual.html

nova_highlighted: $(NOVA_HIGHLIGHTED_HTML)


# Some manuals are not syntax highlighted because the formattingis not right.

non-highlighted: CfengineStdLibrary.html cf3-upgrade.html cf_Quickref3.html 


$(top_builddir)/docs/guides/%.html:
	(cd $(top_builddir)/docs/guides && $(MAKE) $*.html)

$(top_builddir)/nova/docs/%.html:
	(cd $(top_builddir)/docs/guides && $(MAKE) ../../nova/docs/$*.html)

$(top_builddir)/docs/reference/cf3-Reference.html:
	(cd $(top_builddir)/docs/reference && $(MAKE) cf3-Reference.html)

$(HIGHLIGHTED_HTML): %.html: $(top_builddir)/docs/guides/%.html
	cp $< .
	./highlight_syntax $@
	mv $*.trans $@

$(NOVA_HIGHLIGHTED_HTML): %.html: $(top_builddir)/nova/docs/%.html
	cp $< .
	./highlight_syntax $@
	mv $*.trans $@

highlight_syntax: highlight_syntax.c
	gcc -g -o highlight_syntax $<

scan_examples: scan_examples.c
	gcc -g -o $@ $<

cf3-glossary.html: $(top_builddir)/docs/guides/cf3-glossary.html
	cp $< .

CfengineStdLibrary.html: stdlib.texinfo
	makeinfo  --html --no-split --css-include=cfcomdoc.css $<

cf3-upgrade.html: $(top_builddir)/docs/guides/cf3-upgrade.html
	cp $< .

cf3-Reference.html: $(top_builddir)/docs/reference/cf3-Reference.html
	cp $< .

unit_peers.html: examples.cf

examples.cf: Units
	./scan_examples | grep warning

cf_Quickref3.html:  $(top_builddir)/docs/guides/cf_Quickref3.html
	cp $< .

install:

check:
