CFENGINE 3 ENTERPRISE 3.0 Release Candidate 1
RELEASE DATE: November 2012
SCOPE: Release of CFEngine 3 Enterprise 3.0.0 Release Candidate 1

This is a release candidate for testing, not intended for production environments! The commercial version with packages for all regularly supported platforms will be available in December.

----------------------------------------------------------------------------
 TABLE OF CONTENTS:
 PLATFORMS SUPPORTED
 COMPATIBILITY MATRIX
 CHANGE LOG FROM 2.2.x
 NEW DEFAULT POLICY SCHEMA
 BUGFIXES SINCE 2.2.x
 INSTALLATION AND UPGRADE (see separate file 3.0.0RC1-INSTALLATION.TXT)
 KNOWN ISSUES
 IMPORTANT NOTICE FOR THIS RELEASE
----------------------------------------------------------------------------


PLATFORMS SUPPORTED:
CFEngine 3 Free Enterprise is only available for Linux Operating Systems (both hub and client). Commercial CFEngine 3 Enterprise customers have access to all the following Operating Systems:

Hub:
NAME		VERSION					ARCHITECTURE	COMMENT
RHEL 		5, 6					x86-64
(CentOS		5, 6					x86-64		Use RHEL packages)

Clients:
NAME:		VERSION					ARCHITECTURE	COMMENT
RHEL 		5, 6	 				i686,x86-64
(CentOS		5, 6 					i686,x86-64	Use RHEL packages)

Community version base: 3.4.0beta3


COMPATIBILITY MATRIX: 
HUB	CLIENT		TESTED		SUPPORTED	COMMENT
3.0.0	3.0.0		Yes		Yes
3.0.0	2.2.x		No		No		Testing should only be done with current version
3.0.0	2.1.x		No		No		Testing should only be done with current version
3.0.0	2.0.x		No		No		Testing should only be done with current version


CHANGE LOG FROM 2.2.x:
* Redesign of Mission Portal
   - New visual appearance
   - New navigation concepts with shorter paths to different views
   - Rooms renamed to Apps
* New Functionality in Mission Portal
   - SQL Reporting App: Build customizable reports through SQL queries. Schedule reports to send by email (sends link to report). Scheduled reports will be in PDF or CSV format.
   - New Policies App (beta) to view current policy (disabled by default, see following item)
   - Ability to disable any Mission Portal App. The Knowledge and Policies Apps are disabled by default (changeable in the Mission Portal Settings)
   - Ability to select policy context for host compliance graphs and reports. The user can view host/promise/bundle compliance for ALL, USER or SYSTEM (CFEngine specific) promises. SYSTEM promises reside in bundles whos name is prefixed by "cfe_internal_" and promise handle names are also prefixed by "cfe_internal_". Bundles/promise handles that do not have this prefix will be categorized as USER bundles/promises. ALL shows the union of USER and SYSTEM bundles/promises.
* Redesign of default policy schema, see separate section below.
* New Enterprise API (REST v2). The old REST API can be used in parallel.
* Support for collecting reports from hosts behind a NAT boundary/inside a DMZ ("call-collect")
* Ability to delete multiple hosts at the same time.
* Analytics functionality for collecting clicks coordinates, visited pages and software details. This is disabled by default but is possible to activate from the Mission Portal Settings.
* New classes enterprise: enterprise_X, enterprise_X_Y, enterprise_X_Y_Z on CFEngine Enterprise, to reflect the version running. 
* New variable sys.enterprise_version that holds the CFEngine Enterprise version. This complements the Nova classes and the sys.nova_version variable, which will eventually be deprecated.
* Created a variable update_policy.mongodb_dir, for cases where MongoDB should not run out of /var/cfengine/state (could grow to tens of gigabytes).
* Removed commercial_customer class, as it was unused in internal policies. Please use enterprise_edition instead if you used this in your policies.
* Changed verbose output of the agent (prefixed with enterprise> instead of nova>, compliance output adapted to include USER and SYSTEM policy context). See IMPORTANT NOTICE FOR THIS RELEASE below.
* promise_summary.log adapted to include USER and SYSTEM policy context.
* New performance report events: DBPurgeHostsAll, DBMaintenance, DBMaintenanceTimestampsSingleHost, DBCacheCompliance, DBReportCollectAll.
* License verification is made more robust by not relying on the last-seen database anymore. This means you do not need to bootstrap a client to verify the license. See the cf-key --install-license option.
* Pagination of user list, search users (but see known issues).
* Set a system variable by which to identify hosts in the Mission Portal (previously only IP address could be used).
* Deleting a host from the Mission Portal or with the Enterprise API now also removes the host's public key from the database.
* Improvements to the hub maintenance process (less resource intensive and configurable).
* New option (-m) added for cf-hub for Enterprise database maintenance.
* System variables are collected by hub in every delta query
* Sendmail is installed by default on the hub - required for emailing of reports (but see also known issues)
* 32-bit hub installations no longer supported


NEW DEFAULT POLICY SCHEMA:
* promises.cf now only contains the body common control (with the bundle sequence and input file list) and an example agent bundle. All other parts of policy have moved into separate subdirectories (see below).
* New directory structure (under /var/cfengine/masterfiles/ and /var/cfengine/inputs/):
   - cfe_internal/: CFEngine specific policies that ensure system integrity
   - failsafe/: Houses the main failsafe that will be run before each execution of promises.cf (to check for policy and binary updates).
   - controls/: Contains the control bodies for all CFEngine agents
   - services/: Example policy for file watch
* failsafe.cf in /var/cfengine/inputs/: Represents a hard coded backup similar to /var/cfengine/inputs/failsafe/failsafe.cf. NEVER CHANGE THIS FILE, it is there to avoid that policy updates will not be fetched if the user breaks the /var/cfengine/inputs/failsafe/failsafe.cf policy (which would require manually logging in to each affected node to fix).
* CFEngine will not overwrite any existing policy in /var/cfengine/masterfiles/. You will have to migrate manually to the new schema if you already have a policy in place.


BUGFIXES SINCE 2.2.3:
* Fix local tcdb storage of variables that were truncated in reporting due to size (> 1024 bytes).
* Fix incorrect structure of variable report causing apache problems when using REST API.
* Fix listing of users from external authentication (mismatch in user attributes (empty field was populated with data from next user))
* Fix/remove limit in number of entries listed in user list (previously 100 users by default).
* Fix blank listing of externally authenticated users if the database contained more than 1000 entries.
* Fix file change report containing warning message as filename for new/deleted files
* Fix truncation of downloaded reports
* Fix software installed and patches available reports for Ubuntu (now includes CFEngine packages)
* Fix software reports showing "(never)" in the "Last seen" column
* Fix "blue hosts" list being empty for clients that don't have class keys

For fixes to CFEngine Community see separate change log (/var/cfengine/share/doc/ChangeLog).


INSTALLATION AND UPGRADE:
See separate 3.0.0RC1-INSTALLATION.TXT for instructions.


KNOWN ISSUES:
* While using CFEngine's packages promises with package managers (such as: yum/apt etc.), please make sure that valid package names are supplied. Currently there is a problem with evaluating the return codes of the package managers when the package name doesn't exist in the repository. This will eventually result in cf-hub not collecting software reports even if some valid packages are installed/removed/modified.
* Policy context selection will not work unless the policy is updated to the latest schema (using the "cfe_internal_" prefix for bundle names and promise handles).
* A change in hub maintenance process interval from the default 6 hours will effect the time series graph on the Engineering page (may have blanks or other display problems).
* Bug in display of license information for CFEngine 3 Free Enterprise (can show negative number of days, license expired)
* Several CSS bugs in Mission Portal display
* There are known problems with sending email reports, sendmail might not be configured correctly
* Reset of user password will not send new password if email configuration is wrong. Password will be reset, but user cannot access new password and hence will not be able to log in.
* Some operating systems have PHP configured to not accept short tags by default. The Policies app will be blank and left menu in Knowledge app will be incomplete if this is disabled.
* The internal package version for CFEngine will contain SHA string.
* Using RHEL packages for CentOS, the agents will connect to the RHN repository to download additional packages.
* Search users in User Management does not work.


IMPORTANT NOTICE FOR THIS RELEASE:
CFEngine has changed the behavior of the command line interface verbose output from "nova> [MESSAGE]" to "enterprise [MESSAGE]" in this release. In addition, the verbose output of promise compliance has changed format to accomodate the new policy context feature. 

Old style verbose output:
nova> Outcome of version Promises.cf 2.2.3 (agent-0): Promises observed to be kept 100%, Promises repaired 0%, Promises not repaired 0%

New style verbose output:
enterprise> Outcome of version Promises.cf 3.0.0 (agent-0): Promises observed - Total promise compliance: 100% kept, 0% repaired, 0% not kept (out of 6418 events). User promise compliance: 100% kept, 0% repaired, 0% not kept (out of 29 events). CFEngine system compliance: 100% kept, 0% repaired, 0% not kept (out of 6389 events).

The promise_summary.log file has undergone similar format changes to include results for the different policy contexts.

Please make necessary preparations for this as to not break functionality that depends on these messages/log (email filters, post-processing scripts, etc.).

