CFENGINE 3 ENTERPRISE 2.2
CFEngine has renamed CFEngine 3 Nova to CFEngine 3 Enterprise
RELEASE DATE: June 4th, 2012
SCOPE: Official release of CFEngine 3 Enterprise (successor to CFENgine Nova 2.1.3)

PLATFORMS SUPPORTED:
Hub/Policy-server:
NAME		VERSION					ARCHITECTURE
Debian 		6 					i686,x86-64
Ubuntu 		8.04, 10.04, 12.04 			i686,x86-64
RHEL 		5, 6					i686,x86-64

Clients:
NAME:		VERSION					ARCHITECTURE		COMMENT
AIX		5.3, 6.1 				power			No libvirt
CentOS		5, 6 					i686,x86-64
Debian 		5, 6 					i686,x86-64
Fedora 		14, 15, 16 				i686,x86-64
FreeBSD 	7, 8 					i686,amd64		No libvirt
HP-UX										Contact your sales representative
NetBSD 		4.0, 5.0 				i686,amd64		No libvirt
NetBSD 		5.1 					i686,x86-64		No libvirt
openSUSE 	10.2, 10.3, 11.1, 11.2, 11.3, 11.4 	i686,x86-64
RHEL 		4, 5, 6 				i686,x86-64
SLES 		9, 10, 11 				i686,x86-64
SLES 		10, 11 					s390x
SUSE Linux 	9.1, 9.2, 9.3, 10.0, 10.1 		i686,x86-64
Solaris		8, 9, 10 				sparc	 		No libvirt
Solaris 	10 					i86pc	 		No libvirt
Ubuntu		8.04, 8.10, 9.04, 9.10,			i686,x86-64
Ubuntu		10.04, 10.10, 11.04, 11.10, 12.04 	i686,x86-64
Windows 	Server 2003, Server 2008		x86,x64			No libvirt, OpenSSL is not FIPS-enabled

Community version base: 3.3.3


COMPATIBILITY MATRIX: 
HUB	CLIENT		TESTED		SUPPORTED	COMMENT
2.2.0	2.2.0		Yes		Yes
2.2.0	2.1.x		Yes		Yes		Bundle compliance report not compatible
2.2.0	2.0.x		Yes		Yes		Vital signs not complete, Bundle compliance report not compatible
2.1.x	2.2.0		Yes		No		Always use a same or newer version of hub than client
2.0.x	2.2.0		Yes		No		Always use a same or newer version of hub than client


CHANGE LOG FROM 2.1.3:
* Introduction of Role Based Access Control (RBAC) to Mission Portal
* REST API giving read access to most reporting data available in the Mission Portal
* New host category: black (hosts that failed to execute their agents for the last three scheduled rounds)
* Redesign of Engineering Room
    - Host Navigation Tree which allows grouping of hosts, which in turn influences the content on the remainder of the page.
    - Tabulated Status and Reports section
    - Changed Status Summary graph from promise compliance to host compliance for selected context
    - Removal of Report finders, functionality switched to drop-down menus found in Reports tab
    - Some reports have been renamed (Bundle profile, 
    - New Bundle Compliance Summary Report which classifies hosts into red/yellow/green/blue/black groups according to bundle compliance
    - New Promise Compliance Summary Report which classifies hosts into red/yellow/green/blue/black groups according to promise compliance
* Advanced class context filter allowing includes and excludes regular expressions from within reports
* Export reports to CSV from Mission Portal
* Ability to configure the time horizon for which a host is classified as blue (cannot be reached by hub)
* Knowledge Map enhancements to increase usability and ease of use
* More diagnostics on report collection from cf-hub. 
* Software and variable report now contains end-node discovery time.
* Software and patches available/status reports contain maximum 5-minute old data, improved from 6 hours in last release.
* Performance improvement of Software report query
* Upgraded mongodb from version 1.8.2 to 2.0.4, which increases efficiency on concurrency and reduces memory usage.
* New function hostswithclass() that generates a list of hosts in a given class on the hub.
* The bundled failsafe.cf policy now has trustkey=false to avoid IP spoofing attacks in default policy
* Removal of notes from reports
* Hub will manage up to 25 hosts without a license file (Free Enterprise)


BUGFIXES SINCE 2.1.3:
* Fixed issue where client would show as green in the Mission Portal when no data was received, e.g. due to access or license error at client. Now correctly shows as blue in these cases.
* Various bugfixes. See https://cfengine.com/bugtracker/changelog_page.php for change log related to the CFEngine Community Core (versions 3.2.4 to 3.3.3).


INSTALLATION INSTRUCTIONS (CLEAN INSTALL):
* Clean install is tested, upgrade from previous versions of CFEngine 3 Nova tested (see following section)
* As always, install HUB first, then client(s).
* For large systems (> 1000 hosts) we recommend increasing the memory limit in php.conf on the HUB (for instance to 128 MB)

CFEngine 3 Enterprise is provided in two packages, cfengine-nova_2.2.0 and cfengine-nova-expansion_2.2.0 (the nova name remains in the packages to ensure backwards compatibility with package managers). The main software package must be installed on every host (including the hub). The expansion package is only installed on the policy hub. You should install and set up the hub first.

The general installation steps are as follows:
- Copy the CFEngine 3 Enterprise packages to the system.
- Unpack the software
- Send the hub's public key (/var/cfengine/ppkeys/localhost.pub) to CFEngine support to obtain a license (Skip for Free 25 deployment)
- Copy the obtained license file to /var/cfengine/masterfiles/license.dat (Skip for Free 25 deployment)
- Bootstrap the machines to the hub (staring with bootstrapping the hub to itself): /var/cfengine/bin/cf-agent --bootstrap --policy-server <IP ADDRESS OF HUB>
- CFEngine should now be up and running on your system. See Enterprise 2.2 Owner's Manual for more detailed installation instructions.


UPGRADE PROCEDURE:
The following is a general procedure to upgrade from CFEngine 3 Nova 2.1.x to CFEngine 3 Enterprise, see Enterprise 2.2 Owner's Manual for upgrading from older versions. 

Start with the hub (policy server):
* Stop all CFE processes (/etc/init.d/cfengine3 stop)
* Unpack the new software packages
* CFEngine 3 Enterprise's dependencies have changed so we have to correct cf-twin (libgnutls and libmongo.c were updated):
   $ cp /var/cfengine/bin/cf-agent /var/cfengine/bin/cf-twin
* Remove Mongodb lock if present:
   $ rm -f /var/cfengine/state/mongod.lock
* Copy the new CFE_ prefixed policy files to $(sys.workdir)/masterfiles (the files with a prefix "CFE_" are maintained by CFEngine, do not make changes to these, they are there to ensure that the Mission Portal works properly).
   $ cd /var/cfengine/share/NovaBase
   $ cp CFE_cfengine.cf CFE_knowledge.cf CFE_hub_specific.cf /var/cfengine/masterfiles
* Modify a line in @file{/var/cfengine/masterfiles/update.cf} to run mongod as follows (line 242):
   "/var/cfengine/bin/mongod --fork --logpath /var/log/mongod.log --dbpath $ (sys.workdir)/state --bind_ip 127.0.0.1 --nohttpinterface --nojournal --logappend > /dev/null < /dev/null 2>&1"
* Tidy up $(sys.doc_root) directory (example for Debian/Ubuntu):   
   $ rm -rf /var/www/*
* Restart CFEngine processes
   $ /etc/init.d/cfengine3 start

For client upgrades there are 2 approaches: manual or automatic upgrade.
* Manual: Update cfengine-nova on each client by rpm or dpkg command. Update cf-twin as described in step 3 in the update procedure for the hub (i.e. overwrite the old cf-twin).
* Automatic: On the hub, copy the cfengine-nova packages to the operating system specific distribution directories in /var/cfengine/master_software_updates and CFEngine 3 Enterprise will take care of the rest.

CFEngine should now be up and running on your system. See Enterprise 2.2 Owner's Manual for more detailed installation instructions.


SOFTWARE DEPENDENCIES (specific to CFEngine 3 Enterprise)
The CFEngine 3 Enterprise agents on client hosts do not require any additional packages for operation and/or install. The
following section is for the hub only.

CFEngine 3 Enterprise will automatically detect if the necessary packages are already installed on the hub. If new package installation is required, CFEngine 3 Enterprise will install all of them from its default software repository (if configured properly). If the system does not have a default software repository configured, manual installation of these packages will be required.

Note that these mandatory packages may have additional dependencies on their own, and hence additional packages may be installed during the installation process. This process will be handled automatically by CFEngine bootstrap. We do not recommend configuring every component on your own, please contact your CFEngine sales representative in case you cannot use CFEngine's bootstrap procedure.

OpenSuSE 11:
- The Apache Web Server Version 2.0 (apache2, version 2.2.15-3.7)
- PHP5 Module for Apache 2.0 (apache2-mod_php5, version 5.3.3-0.19.1)
- Apache 2 "prefork" MPM (Multi-Processing Module; apache2-prefork, version 2.2.15-3.7)
- PHP5 Core Files (php5, version 5.3.3-0.19.1)
- PHP5 Extension Module
	(php5-json, version 5.3.3-0.19.1)
	(php5-pear, version 5.3.3-0.19.1)
	(php5-mcrypt, version 5.3.3-0.19.1)
	(php5-bcmatch, version 5.3.3-0.19.1)
- A Concurrent Versioning system (subversion, version 1.6.9-4.7.1)

SLES 11:
- The Apache Web Server Version 2.0 (apache2, version 2.2.10-2.24.5)
- PHP5 Module for Apache 2.0 (apache2-mod_php5, version 5.2.6-50.24.1)
- Apache 2 "prefork" MPM (Multi-Processing Module; apache2-prefork, version 2.2.10-2.24.5)
- PHP5 Core Files (php5, version 5.2.6-50.24.11)
- PHP5 Extension Module
	(php5-json, version 5.2.6-50.24.1)
	(php5-pear, version 5.2.6-50.24.1)
	(php5-mcrypt, version 5.2.6-50.24.1)
	(php5-bcmatch, version 5.2.6-50.24.1)
- A Concurrent Versioning system (subversion, version 1.5.7-0.1.1)

RHEL 5:
- Apache HTTP Server (httpd, version 2.2.3-45.el5)
- PHP5 Core Files (php, version 5.1.6-27.el5)
- PHP5 Extension Module
	(php-bcmath, version 5.1.6-27.el5)
	(php-pear, version 5.1.6-27.el5)
- A Concurrent Versioning system (subversion, version 1.5.7-0.1.1)

RHEL 6:
- Apache HTTP Server (httpd, version 2.2.15-9.el6)
- PHP5 Core Files (php, version 5.3.2-6.el6)
- PHP5 Extension Module
	(php-bcmath, version 5.3.2-6.el6)
	(php-pear, version 1:1.9.0-2.el6)
- A Concurrent Versioning system (subversion, version 1.6.11-2.el6_1.4)

CentOS 5:
- Apache HTTP Server (httpd, version 2.2.3-45)
- PHP5 Core Files (php, version 5.1.6-27)
- PHP5 Extension Module
	(php-bcmath, version 5.1.6-27)
	(php-pear, version 5.1.6-27)
	(php-mcrypt, version 5.1.6-27)
- A Concurrent Versioning system (subversion, version 1.6.11-7)

CentOS 6:
- Apache HTTP Server (httpd, version 2.2.15-15.el6.centos.1)
- PHP5 Core Files (php, version 5.3.3-3.el6_2.8)
- PHP5 Extension Module
	(php-bcmath, version 5.3.3-3.el6_2.8)
	(php-pear, version 1.9.4-4.el6)
	(php-mcrypt, version 5.3.3-3.el6_2.8)
- A Concurrent Versioning system (subversion, version 1.6.11-2.el6_1.4)

DEBIAN 6:
- The Apache Web Server Version 2.0 (apache2, version 2.2.16-6+squeeze1)
- PHP5 Core Files (php5, version 5.3.3-7+squeeze3)
- PHP5 Extension Module
	(php5-cli, version 5.3.3-7+squeeze3)
	(php5-mcrypt, version 5.3.3-7+squeeze3)
	(php-pear, version 5.3.3-7+squeeze3)
- A Concurrent Versioning system (subversion, version 1.6.12dfsg-6)

UBUNTU 8:
- The Apache Web Server Version 2.0 (apache2, version 2.2.8-1)
- PHP5 Core Files (php5, version 5.2.4-2ubuntu5.17)
- PHP5 Extension Module
	(php5-cli, version 5.2.4-2ubuntu5.17)
	(php5-mcrypt, version 5.2.3-0ubuntu1)
	(php-pear, version version 5.2.4-2ubuntu5.17)
- A Concurrent Versioning system (subversion, version 1.4.6dfsg1-2ubuntu1.3)

UBUNTU 10:
- The Apache Web Server Version 2.0 (apache2, version 2.2.14-5ubuntu8.4)
- PHP5 Core Files (php5, version 5.3.2-1ubuntu4.9)
- PHP5 Extension Module
	(php5-cli, version 5.3.2-1ubuntu4.9)
	(php5-mcrypt, version 5.3.2-0ubuntu1)
	(php-pear, version version 5.3.2-1ubuntu4.9)
- A Concurrent Versioning system (subversion, version 1.6.6dfsg-2ubuntu1)

UBUNTU 12:
- The Apache Web Server Version 2.0 (apache2, version 2.2.22-1ubuntu1)
- PHP5 Core Files (php5, version 5.3.10-1ubuntu3)
- PHP5 Extension Module
	(php5-cli, version 5.3.10-1ubuntu3)
	(php5-mcrypt, version 5.3.10-1ubuntu3)
	(php-pear, version version 5.3.10-1ubuntu3.1)
- A Concurrent Versioning system (subversion, 1.6.17dfsg-3ubuntu3)

KNOWN ISSUES:
* Software and patches available/status reports containing maximum 5-minute old data: will only apply to clients that are upgraded to 2.2.0.
* Compliance by bundle reports are incompatible with older clients (CFEngine Nova 2.1.4 and down). Data from these clients will not show in the reports.
* Verbose output in command line interface (CLI) still indicates that you are using CFEngine 3 Nova (i.e. the CLI prefixes the verbose output with "nova> [MESSAGE]". See message for next release below.
* Bulk of CFEngine testing effort done with license file installed (Free version without license file might have additional issues aside from this document)
* RBAC will not work out of the box after an upgrade from an earlier version, use following procedure as a workaround:
  - Launch the mongo shell:
      $ /var/cfengine/bin/mongo
  - Drop roles and groups database:
      > use phpcfengine
      > db.roles.drop()
      > db.groups.drop()
  - Run the export.js script from terminal:
      $ /var/cfengine/bin/mongo phpcfengine /var/cfengine/share/GUI/phpcfenginenova/export.js
  - Please contact CFEngine support if you run into any problems.

IMPORTANT NOTICE FOR NEXT RELEASE:
CFEngine will change the behavior of the command line interface verbose output from "nova> [MESSAGE]" to "enterprise [MESSAGE]" for the next version of CFEngine 3 Enterprise. Please make necessary preparations for this as to not break functionality that depends on these messages (email filters, post-processing scripts, etc.).



