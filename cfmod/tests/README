Tests for cfmod API functions
-----------------------------

Requirements: php cli, valgrind, bash

Environment assumptions: 
 *) mongod running on default port
 *) mongo shell is in /var/cfengine/bin/mongo
 *) There is some data in the mongo database to test with

Usage: Run ./testall

The purpose of these tests are to
*) Detect functions that are too slow (the UI user waits for these to complete)
*) Detect memory errors, such as illegal access and leaks
*) Make a quick reference of the cfmod-functions and their parameters

These are not meant to test functionality (the output from cfmod is discarded).
This is because functional testing is already covered by the web application framework,
and having it there makes more sense as it also covers mis-interpretation of input and output
by the developers.

We are passing parameters to the php-functions through environment-variables.

To test RBAC, turn it on (e.g. from the Mission Portal), and input a limited user
in addition to the default "admin" user (currently hardcoded in testall).

The speed testing is a bit flaky because we just have one data-point. However,
running the test multiple times sequentially to produce averages/std dev may not give 
the correct result because the database may have cached the previous
run, and it would increase the total test time significantly. 
Some investigation into this would be useful.



TODOs
 - test more parameters
   - RBAC: off/is limited user/is admin user
   - hostkey: NULL/a specific host
   - classregex: NULL/a small set of hosts matching/a large set of hosts matching
   - need assumptions about environment: hostkey, class, RBAC users (functionality to set up a test envrionment)
 - add more tests
