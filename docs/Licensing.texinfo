\input texinfo-altfont
\input texinfo-logo
\input texinfo
@selectaltfont{cmbright}
@setlogo{CFEngineFrontPage}

@c *********************************************************************
@c
@c  This is a TEXINFO file. It generates both TEX documentation and
@c  the "on line" documentation "info" files.
@c
@c  The file is structured like a programming language. Each chapter
@c  starts with a chapter comment.
@c
@c  Menus list the subsections so that an online info-reader can parse
@c  the file hierarchically.
@c
@c ***********************************************************************
@c %** start of header
@setfilename st-licenses.info
@settitle Licenses
@setchapternewpage odd
@c %** end of header

@titlepage
@title Licenses
@subtitle A CFEngine Special Topics Handbook
@author CFEngine AS


@page

@cartouche
@quotation
This document describes how licenses are acquired and maintained
across distributed installations of CFEngine commercial products.
@end quotation
@end cartouche

@vskip 0pt plus 1filll
Copyright @copyright{} 2010- CFEngine AS

@end titlepage


@c *************************** File begins here ************************


@ifinfo
@dircategory CFEngine Training
@direntry
* CFEngine Modularization:
                      CFEngine is a language based tool specifically
                      designed for configuring and maintaining
                      Unix-like operating systems attached
                      to a TCP/IP network.
@end direntry
@end ifinfo

@ifnottex
@node Top
@top CFEngine-Tutorial
@end ifnottex
@iftex
@contents
@end iftex

@ifhtml
@html
<a href="#Contents"><h1>COMPLETE TABLE OF CONTENTS</h1></a>
<h2>Summary of contents</h2>
@end html
@end ifhtml




@unnumberedsec What is a CFEngine license?

@sp 1

A license is an authorization to use a commercial edition of the
CFEngine software. It consists of a single file, generated by CFEngine
AS headquarters in Norway. The file enables the CFEngine software to track
authorizations of commercial editions, e.g.  CFEngine
Nova or CFEngine Constellation.

Commercial versions of the CFEngine software that are not authorized
revert to behaving just like the open community editions. This allows them
to function in a limited capacity to assist you in deploying licenses
or upgrading licenses.

@unnumberedsec Why do I need a license?

@sp 1

The extra facilities provided by commercial editions of CFEngine are
subscription based, and must be paid for. License files enable these
extra features for commercial editions.

@unnumberedsec Will I need a license server?
@sp 1

No. In our experience, license servers have few redeeming features.
It is CFEngine's policy that CFEngine should make computer
administration simpler, not more difficult. Our licenses serve
two purposes:
@itemize
@item To enable additional features for the duration of a subscription contract.
@item To assist users in tracking systems that are using the CFEngine commercial editions,
so that they are not violating the legal terms of their contract.
@end itemize


@unnumberedsec How do you obtain a license?

@sp 1

To obtain a commercial license from CFEngine, you must first have
signed a contract (purchase order) with the Company or one of its
partners.  This entitles you to run a limited number of licensed
instances of the CFEngine software. You may not mix different editions
of CFEngine software, and the license is for whatever version you have
paid for.

Once a purchase has been made, you must send CFEngine Support a copy
of the @i{public key file} belonging to each host you wish to be a
CFEngine @i{policy server}, along with an estimate of the maximum
number of clients that is expected to use each server. 
The maximum number of licenses is fixed by the contract.

@cartouche
Create a license request on @url{http://ticket.CFEngine.com} with the
public key as an attachment.
@end cartouche

The public key file lies in the CFEngine working directory, e.g.

@verbatim
policyhost# ls /var/cfengine/ppkeys/localhost.pub
@end verbatim

To generate such a public key you must use some edition of the
CFEngine software (either the Community Edition, or an unlicensed
version of a commercial product from a pilot demo. etc). You generate
key pair by running this command:

@sp 1
@cartouche
@verbatim
host# cf-key
@end verbatim
@end cartouche
@sp 1

@noindent If you have been through a pilot process, or if you have used the Community Edition of CFEngine, you will already
have this file.  You must then send the file @code{localhost.pub} for
each host.



@unnumberedsec How should I choose my policy servers?

@sp 1

Your policy server is the single point of change for CFEngine
management.  It is the server host on which all policy changes are
deployed, and it also doubles as a knowledge aggregator and a license
tracker. This host should be able to exchange data with every instance
running CFEngine at some time.

For some organizations, a single policy server is enough. More complex
environments, that are distributed geographically or have
intermittent communications, such as

@itemize
@item Ships
@item Aircraft
@item Probes
@item Mobile devices
@end itemize
@noindent need to have localized policy servers. These can be
managed independently, or they can act as staging servers for a central
master-server.  CFEngine does not place any restrictions on you here; we
can provide multiple licenses for implementing such a model if you
wish.

@unnumberedsec What should you do with the license?

@sp 1

When you receive the license file from us, you must install it on every host.
The simplest way to do this is to install CFEngine on the policy server(s)
first and install it there. 
Install the file in the @file{/var/cfengine/masterfiles} directory of the policy
server(s), e.g.

@sp 1
@cartouche
@verbatim
mkdir -p /var/cfengine/masterfiles
cp license.dat /var/cfengine/masterfiles
@end verbatim
@end cartouche
@sp 1

@noindent Now, when you bootstrap each client, the license will follow automatically.
The @file{license.dat} file should ultimately end up in the
@file{/var/cfengine/inputs} (or Windows equivalent) directory on each host to
enable the license.

To summarize, a complete license for each client host consists of
@itemize
@item The license file (e.g. @file{license.dat} in @file{inputs})
@item The policy server's public key (i.e. @file{root-123.456.789.123.pub} on clients or @file{localhost.pub} on policy servers in @file{ppkeys})
@end itemize
@noindent 
For each client machine, you bootstrap with (possbly temporary)
network connectivity to the policy server (this is convenient for the exchange
of files):

@sp 1
@cartouche
@verbatim
host# cf-agent --bootstrap --policy-server 123.456.789.123
@end verbatim
@end cartouche
@sp 1

If for some reason your hosts are permanently off-line, or cannot
authorize at the time of installation, you will need to copy these
files manually, off line.

As long as these files are present, CFEngine does not care whether
hosts are on- or off-line.

@unnumberedsec Promising your number of licenses

You need to do one more thing in the CFEngine configuration.
You must make a promise about the number of CFEngine instances
you can paid for. This is a confirmation from you that documents
in reports what you claim to have paid for

@verbatim
body common control

{
bundlesequence  => {
                   "update",
                   "garbage_collection",
                   "change_management",
                   #...
                   };

inputs          => {
                   "CFEngine.cf",
                   "CFEngine_stdlib.cf",
                   };

version => "1.2.3";

host_licenses_paid => "100";
}

@end verbatim

@noindent You should make this promise both in @file{promises.cf}
and @file{failsafe.cf}.

@unnumberedsec What does CFEngine the company do with the license?

@sp 1
CFEngine keeps the number of licenses purchased for your edition on
file, and asks you to report how many instances you are running at
regular intervals for accounting purposes. This report can be generated
from each CFEngine policy server itself.


@bye
